version: '3.8'

networks:
  kharj-mysql-network:
    external: true

services:
  app:
    container_name: kharj-app
    build: ../
    restart: always
    volumes:
      - ../front:/usr/src/app/dist/public/front
    ports:
      - '3005:3005'
    environment:
      - MYSQL_HOST=kharj-mysql
      - MYSQL_PORT=3306
      - MYSQL_USERNAME=root
      - MYSQL_PASSWORD=13578642sM@K
      - MYSQL_DATABASE=kharjdb
      - APP_PORT=3005
      - APP_BASE_URL=http://localhost:3005
      - JWT_SECRET_KEY=lkfdsjglksdjflkdjglksajdlkdsajvlksjfdav
    networks:
      - kharj-mysql-network

  mysql:
    container_name: kharj-mysql
    build: ./mysql
    restart: always
    volumes:
      - ./mysql/container-data/data:/var/lib/mysql
      - ./mysql/container-data/conf/mysqld.conf:/etc/mysql/mysql.conf.d/mysqld.cnf
    ports:
      - '3307:3306'
    networks:
      - kharj-mysql-network
    environment:
      - MYSQL_ROOT_PASSWORD=13578642sM@K
      - TZ=Asia/Tehran
    command:
      - --default-authentication-plugin=mysql_native_password

  #  metabase:
  #    container_name: kharj-metabase
  #    image: metabase/metabase:v0.54.18.x
  #    restart: always
  #    ports:
  #      - "3003:3000"
  #    networks:
  #      - kharj-mysql-network
  #    volumes:
  #      - ./metabase/container-data/dev/urandom:/dev/random:ro
  #    depends_on:
  #      - mysql
  #    environment:
  #      - MB_DB_TYPE=mysql
  #      - MB_DB_DBNAME=kharjdb
  #      - MB_DB_PORT=3306
  #      - MB_DB_USER=metabase
  #      - MB_DB_PASS=13578642@@Fme
  #      - MB_DB_HOST=kharj-mysql

  phpmyadmin:
    container_name: kharj-phpmyadmin
    image: phpmyadmin:5.1-apache
    restart: always
    ports:
      - '8083:80'
    networks:
      - kharj-mysql-network
    depends_on:
      - mysql
    environment:
      - PMA_HOST=kharj-mysql
